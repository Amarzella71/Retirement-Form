<script>
  document.getElementById("retirementForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const formData = new FormData(this);
    const formObj = {};

    // Ensure all fields (even checkboxes) are included
    for (const element of this.elements) {
      if (element.name) {
        if (element.type === "checkbox") {
          formObj[element.name] = element.checked;
        } else {
          formObj[element.name] = element.value;
        }
      }
    }

    try {
      const response = await fetch("https://retirement-backend-api.onrender.com/submit-retirement-form", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formObj)
      });

      const result = await response.json();

      if (response.ok) {
        alert("✅ Retirement plan submitted successfully. Check your email!");
      } else {
        // Show readable validation errors
        if (Array.isArray(result.detail)) {
          const messages = result.detail.map(d => `• ${d.loc.join('.')}: ${d.msg}`).join('\\n');
          alert("❌ Error:\\n" + messages);
        } else {
          alert("❌ Error: " + JSON.stringify(result.detail));
        }
      }
    } catch (error) {
      console.error("Submission failed", error);
      alert("❌ Submission failed: " + error.message);
    }
  });
</script>
